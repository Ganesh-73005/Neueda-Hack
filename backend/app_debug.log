2025-06-07 10:01:27,422 - __main__ - DEBUG - Processing bill for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12
2025-06-07 10:01:27,431 - __main__ - DEBUG - Saved file to temporary location: C:\Users\ganes\AppData\Local\Temp\tmpu12f2i3f\temp-2.jpg
2025-06-07 10:01:35,138 - __main__ - DEBUG - Extracted text from image (first 100 chars): TAX
TATA MOTORS LIMITED
GSTIN 27AAACT2727QIZW
Nigadi Bhosari Road , PIMPRI
Pune, MAHARASHTRA, 41...
2025-06-07 10:01:35,139 - __main__ - DEBUG - Extracted GST number: 27AAACT2727QIZW
2025-06-07 10:01:35,142 - __main__ - ERROR - Error in process_bill: name 'get_gst_captcha_data' is not defined
Traceback (most recent call last):
  File "C:\Users\ganes\source\repos\CITI-HACK\backend\app.py", line 384, in process_bill
    captcha_response = get_gst_captcha_data()
                       ^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_gst_captcha_data' is not defined
2025-06-07 10:02:09,570 - __main__ - DEBUG - Processing bill for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12
2025-06-07 10:02:09,578 - __main__ - DEBUG - Saved file to temporary location: C:\Users\ganes\AppData\Local\Temp\tmph8jl75wb\temp-2.jpg
2025-06-07 10:02:17,155 - __main__ - DEBUG - Extracted text from image (first 100 chars): TAX
TATA MOTORS LIMITED
GSTIN 27AAACT2727QIZW
Nigadi Bhosari Road , PIMPRI
Pune, MAHARASHTRA, 41...
2025-06-07 10:02:17,157 - __main__ - DEBUG - Extracted GST number: 27AAACT2727QIZW
2025-06-07 10:02:17,161 - __main__ - ERROR - Error in process_bill: name 'get_gst_captcha_data' is not defined
Traceback (most recent call last):
  File "C:\Users\ganes\source\repos\CITI-HACK\backend\app.py", line 384, in process_bill
    captcha_response = get_gst_captcha_data()
                       ^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_gst_captcha_data' is not defined
2025-06-07 10:03:44,889 - __main__ - DEBUG - Processing bill for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12
2025-06-07 10:03:44,902 - __main__ - DEBUG - Saved file to temporary location: C:\Users\ganes\AppData\Local\Temp\tmpe_16rsr_\temp-2.jpg
2025-06-07 10:03:49,877 - __main__ - DEBUG - Extracted text from image (first 100 chars): TAX
TATA MOTORS LIMITED
GSTIN 27AAACT2727QIZW
Nigadi Bhosari Road , PIMPRI
Pune, MAHARASHTRA, 41...
2025-06-07 10:03:49,878 - __main__ - DEBUG - Extracted GST number: 27AAACT2727QIZW
2025-06-07 10:03:49,879 - __main__ - DEBUG - Attempting to fetch GST captcha
2025-06-07 10:03:49,880 - __main__ - DEBUG - Fetching captcha from URL: https://services.gst.gov.in/services/captcha?rnd=0.12409023023733068
2025-06-07 10:03:50,287 - __main__ - DEBUG - Successfully encoded captcha image to base64
2025-06-07 10:03:50,288 - __main__ - DEBUG - Parsing captcha cookie from headers
2025-06-07 10:03:50,289 - __main__ - DEBUG - Extracted captcha cookie: 8f2df301f4...
2025-06-07 10:03:50,290 - __main__ - DEBUG - Saving captcha image to: uploads\captcha_3880.png
2025-06-07 10:03:50,292 - __main__ - DEBUG - Captcha image saved successfully
2025-06-07 10:03:50,295 - __main__ - DEBUG - Successfully fetched GST captcha
2025-06-07 10:03:50,296 - __main__ - DEBUG - Starting expense categorization for text: TAX
TATA MOTORS LIMITED
GSTIN 27AAACT2727QIZW
Nigadi Bhosari Road , PIMPRI
Pune, MAHARASHTRA, 41...
2025-06-07 10:03:50,297 - __main__ - DEBUG - Sending prompt to Groq API
2025-06-07 10:03:52,237 - __main__ - DEBUG - Received response from Groq API: Here is the extracted information in the desired JSON format:

```
{
    "total_amount": "145281.20",
    "store_name": "TATA MOTORS LIMITED",
    "date": "17 Jun 2023",
    "items": [
        {
     ...
2025-06-07 10:03:52,238 - __main__ - DEBUG - No markdown JSON found, trying direct parse
2025-06-07 10:03:52,240 - __main__ - ERROR - Failed to parse direct JSON: Expecting value: line 1 column 1 (char 0)
2025-06-07 10:03:52,241 - __main__ - DEBUG - Expense categorization result: None
2025-06-07 10:04:05,741 - __main__ - DEBUG - Validating GST for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12 with data: {'gst_number': '27AAACT2727QIZW', 'captcha': '786208', 'captcha_cookie': '8f2df301f4ca402999b791f29e9b99a6', 'expense_data': None}
2025-06-07 10:04:05,742 - __main__ - ERROR - Invalid GST checksum for number: 27AAACT2727QIZW
2025-06-07 10:05:22,614 - __main__ - DEBUG - Processing bill for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12
2025-06-07 10:05:22,626 - __main__ - DEBUG - Saved file to temporary location: C:\Users\ganes\AppData\Local\Temp\tmp1ojngce8\temp-2.jpg
2025-06-07 10:05:25,457 - __main__ - DEBUG - Extracted text from image (first 100 chars): TAX
TATA MOTORS LIMITED
GSTIN 27AAACT2727QIZW
Nigadi Bhosari Road , PIMPRI
Pune, MAHARASHTRA, 41...
2025-06-07 10:05:25,459 - __main__ - DEBUG - Extracted GST number: 27AAACT2727QIZW
2025-06-07 10:05:25,461 - __main__ - DEBUG - Attempting to fetch GST captcha
2025-06-07 10:05:25,463 - __main__ - DEBUG - Fetching captcha from URL: https://services.gst.gov.in/services/captcha?rnd=0.4449756968025377
2025-06-07 10:05:26,011 - __main__ - DEBUG - Successfully encoded captcha image to base64
2025-06-07 10:05:26,012 - __main__ - DEBUG - Parsing captcha cookie from headers
2025-06-07 10:05:26,013 - __main__ - DEBUG - Extracted captcha cookie: a352dcdec7...
2025-06-07 10:05:26,016 - __main__ - DEBUG - Saving captcha image to: uploads\captcha_3333.png
2025-06-07 10:05:26,019 - __main__ - DEBUG - Captcha image saved successfully
2025-06-07 10:05:26,024 - __main__ - DEBUG - Successfully fetched GST captcha
2025-06-07 10:05:26,026 - __main__ - DEBUG - Starting expense categorization for text: TAX
TATA MOTORS LIMITED
GSTIN 27AAACT2727QIZW
Nigadi Bhosari Road , PIMPRI
Pune, MAHARASHTRA, 41...
2025-06-07 10:05:26,028 - __main__ - DEBUG - Sending prompt to Groq API
2025-06-07 10:05:27,858 - __main__ - DEBUG - Received response from Groq API: Here is the extracted information in the requested JSON format:

```
{
    "total_amount": "2499000",
    "store_name": "TATA MOTORS LIMITED",
    "date": "17 Jun 2023",
    "items": [
        {
     ...
2025-06-07 10:05:27,860 - __main__ - DEBUG - No markdown JSON found, trying direct parse
2025-06-07 10:05:27,862 - __main__ - ERROR - Failed to parse direct JSON: Expecting value: line 1 column 1 (char 0)
2025-06-07 10:05:27,864 - __main__ - DEBUG - Expense categorization result: None
2025-06-07 10:05:38,128 - __main__ - DEBUG - Validating GST for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12 with data: {'gst_number': '27AAACT2727QIZW', 'captcha': '700725', 'captcha_cookie': 'a352dcdec7b4461fb9f8c92a8f306303', 'expense_data': None}
2025-06-07 10:05:38,128 - __main__ - DEBUG - Sending GST validation request with payload: {'gstin': '27AAACT2727QIZW', 'captcha': '700725'}
2025-06-07 10:05:38,603 - __main__ - DEBUG - Received GST validation response: {'url': '/', 'message': None, 'errorCode': 'SWEB_9035'}
2025-06-07 10:05:38,604 - __main__ - ERROR - Invalid GST number response from API: 27AAACT2727QIZW
2025-06-07 10:17:25,433 - __main__ - DEBUG - Processing bill for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12
2025-06-07 10:17:25,460 - __main__ - DEBUG - Saved file to temporary location: C:\Users\ganes\AppData\Local\Temp\tmpgqg9p4k_\temp-2.jpg
2025-06-07 10:17:25,462 - __main__ - DEBUG - Extracting text from image using Tesseract: C:\Users\ganes\AppData\Local\Temp\tmpgqg9p4k_\temp-2.jpg
2025-06-07 10:17:25,868 - __main__ - ERROR - Error in extract_text_from_image: tesseract is not installed or it's not in your PATH. See README file for more information.
Traceback (most recent call last):
  File "C:\Users\ganes\AppData\Local\Programs\Python\Python311\Lib\site-packages\pytesseract\pytesseract.py", line 275, in run_tesseract
    proc = subprocess.Popen(cmd_args, **subprocess_args())
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ganes\AppData\Local\Programs\Python\Python311\Lib\subprocess.py", line 1026, in __init__
    self._execute_child(args, executable, preexec_fn, close_fds,
  File "C:\Users\ganes\AppData\Local\Programs\Python\Python311\Lib\subprocess.py", line 1538, in _execute_child
    hp, ht, pid, tid = _winapi.CreateProcess(executable, args,
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [WinError 2] The system cannot find the file specified

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ganes\source\repos\CITI-HACK\backend\app.py", line 263, in extract_text_from_image
    text = pytesseract.image_to_string(img)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ganes\AppData\Local\Programs\Python\Python311\Lib\site-packages\pytesseract\pytesseract.py", line 486, in image_to_string
    return {
           ^
  File "C:\Users\ganes\AppData\Local\Programs\Python\Python311\Lib\site-packages\pytesseract\pytesseract.py", line 489, in <lambda>
    Output.STRING: lambda: run_and_get_output(*args),
                           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ganes\AppData\Local\Programs\Python\Python311\Lib\site-packages\pytesseract\pytesseract.py", line 352, in run_and_get_output
    run_tesseract(**kwargs)
  File "C:\Users\ganes\AppData\Local\Programs\Python\Python311\Lib\site-packages\pytesseract\pytesseract.py", line 280, in run_tesseract
    raise TesseractNotFoundError()
pytesseract.pytesseract.TesseractNotFoundError: tesseract is not installed or it's not in your PATH. See README file for more information.
2025-06-07 10:17:25,908 - __main__ - ERROR - Failed to extract text from image
2025-06-07 10:21:33,862 - __main__ - DEBUG - Processing bill for user: 45e7c662-000f-4e06-ae87-8a51a32a7c12
2025-06-07 10:21:33,878 - __main__ - DEBUG - Saved file to temporary location: C:\Users\ganes\AppData\Local\Temp\tmpn6trzh2t\temp-2.jpg
2025-06-07 10:21:48,799 - __main__ - DEBUG - Extracted GST number: 27AAACT2727Q1ZW
